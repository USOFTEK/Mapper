require 'rsolr'

class Search

def initialize
	@solr = RSolr.connect :url => 'http://localhost:8983/solr/mapper'
	index # <= проводимо індексування кожен раз перед пошуком
end

def get_total_docs

	total = @solr.get 'select', :params => {:q => "*:*", :wt => :ruby}
	count = total["response"]["numFound"]
	raise TypeError "Wrong response" if count.nil?
	p "Total docs found: #{count.to_i}"
	count
end
#TODO: включити правильно delta-import
def get_import_type
	(get_total_docs) ? 'delta-import' : 'full-import'
	'full-import'
end
#індексування бази
def index
	response = @solr.get 'dataimport', :params => {:command => get_import_type}
	p response
	self
end
def search
	(ARGV[0].empty?) ? query = "video" : query = ARGV[0]
	response = @solr.get 'select', :params => {:q => query, :wt => :ruby}
    	p response
end
end

