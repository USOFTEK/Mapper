class ShopItem < Storage
      def self.escape_row(row)
        @@db.escape row || "NULL"
      end
      def self.add(data, filename)
        insertion = Price.add(filename)
        insertion.callback do 
          price_id = @@db.last_id
          values = []
          query_string =  "INSERT INTO `products` (`code`, `title`, `article`, `price_id`) VALUES "
          data[:results].each do |row|
            values << "('#{self.escape_row row["code"]}','#{self.escape_row row["title"]}','#{self.escape_row row["article"]}','#{price_id}')"
          end
          query = query_string + values.join(",")
          @@db.aquery(query)
        end
end
